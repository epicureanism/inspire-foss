<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <link rel="stylesheet" href="OpenLayers/theme/default/style.css" type="text/css"/>
    <script src="OpenLayers/OpenLayers.js"></script>
    <script type="text/javascript">
        function init(){
          var loc = window.location + ""
          if(loc.lastIndexOf("/") != loc.length - 1) loc = loc.substring(0, loc.lastIndexOf("/") + 1)

          var map = new OpenLayers.Map( 'map', {
            projection: new OpenLayers.Projection("EPSG:900913"),
            units: "m",
            maxResolution: 156543.0339,
            maxExtent: new OpenLayers.Bounds(-20037508.34, -20037508.34, 20037508.34, 20037508.34),
            allOverlays: true
          } )

          var osmLayer = new OpenLayers.Layer.OSM("OpenStreetMap")
          map.addLayer(osmLayer)

          var req = new XMLHttpRequest()

          req.open("GET", loc + "../../services?request=GetCapabilities&service=WMS&version=1.1.1", false)
          req.send(null)
          var res = req.responseXML

          res = res.evaluate('//Layer/Name', res.documentElement, null, 0, null)
          var next = res.iterateNext()
          while(next){
            var layer = new OpenLayers.Layer.WMS( next.nodeValue, loc + "../../services", {layers: next.textContent, transparent: true}, {singleTile: true})
            layer.setName(next.textContent)
            layer.setVisibility(false)
            map.addLayer(layer)
            next = res.iterateNext()
          }

          map.setCenter(new OpenLayers.LonLat(0, 0), 0)
          map.addControl(new OpenLayers.Control.LayerSwitcher())
        }
    </script>
  </head>
  <body onload="init()">
    <h1 id="title">Your WMS</h1>
    <div id="tags">
    </div>
    <p id="shortdesc">
      This is an OpenLayers instance which is automatically configured with all the WMS layers.
    </p>
    <div id="map" class="largemap"/>
  </body>
</html>
