<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (C) 2010  Het Kadaster - The Netherlands
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<xsl:stylesheet version="1.0" xmlns:app="http://www.deegree.org/app"
				xmlns:CP="urn:x-inspire:specification:gmlas:CadastralParcels:3.0"
				xmlns:GN="urn:x-inspire:specification:gmlas:GeographicalNames:3.0"
				xmlns:base="urn:x-inspire:specification:gmlas:BaseTypes:3.2"
				xmlns:gml="http://www.opengis.net/gml"
				xmlns:xlink="http://www.w3.org/1999/xlink"
				xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
				xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
	<xsl:output method="xml" version="1.0" encoding="UTF-8"/>

	<xsl:template name="PARCEL">
		<CP:CadastralParcel>
			<xsl:attribute name="gml:id">
				<xsl:value-of select="CP:CadastralParcel/@gml:id" xmlns:gml="http://www.opengis.net/gml"/>
			</xsl:attribute>
			<xsl:apply-templates select="CP:CadastralParcel"/>
		</CP:CadastralParcel>
	</xsl:template>

	<xsl:template match="CP:CadastralParcel" name="ParcelTemplate">

		<CP:beginLifespanVersion xsi:nil="true" nilReason="UNKNOWN"/>

		<CP:endLifespanVersion xsi:nil="true" nilReason="UNKNOWN"/>

		<!-- geometry is mandatory -->
		<CP:geometry>
			<gml:MultiSurface>
				<xsl:attribute name="gml:id">
					<xsl:value-of select="concat(./@gml:id,'_G')" xmlns:gml="http://www.opengis.net/gml"/>
				</xsl:attribute>
				<gml:surfaceMember>
					<gml:Surface>
						<xsl:attribute name="gml:id">
							<xsl:value-of select="concat(./@gml:id,'_GS')" xmlns:gml="http://www.opengis.net/gml"/>
						</xsl:attribute>
						<gml:patches>

							<gml:PolygonPatch>
								<gml:exterior>
									<gml:LinearRing>
										<gml:posList>
											<xsl:attribute name="count">
												<xsl:value-of
															select="CP:geometry//gml:posList/@count" xmlns:gml="http://www.opengis.net/gml"/>
												</xsl:attribute>
											<xsl:attribute name="srsDimension">2</xsl:attribute>


											<xsl:value-of
													select="CP:geometry//gml:posList" xmlns:gml="http://www.opengis.net/gml"/>
										</gml:posList>
									</gml:LinearRing>
								</gml:exterior>
							</gml:PolygonPatch>
						</gml:patches>
					</gml:Surface>
				</gml:surfaceMember>

			</gml:MultiSurface>
		</CP:geometry>

		<!-- inspireId is mandatory -->
		<CP:inspireId>
			<base:Identifier>
				<base:localId>
					<xsl:value-of select="CP:inspireId/CP:Identifier/CP:localId"/>
				</base:localId>
				<base:namespace>
					<xsl:value-of select="CP:inspireId/CP:Identifier/CP:namespace"/>
				</base:namespace>
			</base:Identifier>
		</CP:inspireId>

		<!-- label is mandatory -->
		<CP:label>
			<xsl:value-of select="CP:label"/>
		</CP:label>

		<!-- nationalCadastralReference is mandatory -->
		<CP:nationalCadastralReference>
			<xsl:value-of select="CP:nationalCadastralReference"/>
		</CP:nationalCadastralReference>

	</xsl:template>

</xsl:stylesheet>
